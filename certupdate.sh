#!/bin/bash

# مسیر مورد نظر شما
CERTS_DIR="/var/lib/marznode/certs"

# اگر پوشه وجود نداشته باشد، آن را می‌سازد (-p یعنی اگر والد هم نبود بساز)
if [ ! -d "$CERTS_DIR" ]; then
    echo "Directory $CERTS_DIR does not exist. Creating it..."
    mkdir -p "$CERTS_DIR"
fi

echo "Writing certificate files..."

# ایجاد یا بازنویسی فایل fullchain.pem
cat > "$CERTS_DIR/fullchain.pem" << 'EOF'
-----BEGIN CERTIFICATE-----
MIID3jCCA2OgAwIBAgISBqKhNdHFs+B4HbiZfLx+7LM/MAoGCCqGSM49BAMDMDIx
CzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQDEwJF
ODAeFw0yNjAyMDcwOTU0NDBaFw0yNjA1MDgwOTU0MzlaMBcxFTATBgNVBAMTDG1o
dWJiLW1jYy5pcjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABO+IyxbyDkebJVwV
Ge5xd2bM7H2KZdKKqkuuZbPsbbhs4Q5TDNuFvun3MSIC4QqOkLLI6Ui1yGfNC8H+
fSmQPw2jggJyMIICbjAOBgNVHQ8BAf8EBAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUH
AwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFKi4M7zUWrwFruJO
G/wRaC1URhd2MB8GA1UdIwQYMBaAFI8NE6L2Ln7RUGwzGDhdWY4jcpHKMDIGCCsG
AQUFBwEBBCYwJDAiBggrBgEFBQcwAoYWaHR0cDovL2U4LmkubGVuY3Iub3JnLzBn
BgNVHREEYDBegg4qLm1odWJiLW1jYy5pcoILKi5taXplMzYuaXKCEyouc2VuaW9y
ci1sZWFybm4uaXKCDG1odWJiLW1jYy5pcoIJbWl6ZTM2LmlyghFzZW5pb3JyLWxl
YXJubi5pcjATBgNVHSAEDDAKMAgGBmeBDAECATAtBgNVHR8EJjAkMCKgIKAehhxo
dHRwOi8vZTguYy5sZW5jci5vcmcvNjQuY3JsMIIBDAYKKwYBBAHWeQIEAgSB/QSB
+gD4AHcADleUvPOuqT4zGyyZB7P3kN+bwj1xMiXdIaklrGHFTiEAAAGcN7v1EAAA
BAMASDBGAiEAmng/LQF63T+R1PwPI46+4flMNCPEMEeP+q9Ff2EyOZQCIQCtLOlG
AvVsS8HWkTx05q8k1SLc5uDFxp3Fb0U5MFeZNwB9AOMjjfKNoojgquCs8PqQyYXw
tr/10qUnsAH8HERYxLboAAABnDe79+QACAAABQAxzbY6BAMARjBEAiABrewox9BX
M/aRQ3OHdmbXbEn9oHXBWoZhs1AvtxzdZQIgYLpWIgJS96SN1ODJj1b0T2xo2cpX
PogUk1lqjPSNZlcwCgYIKoZIzj0EAwMDaQAwZgIxALBqQPmm0SpwQWbD+fiArPzE
UnHIgJJmdPPwMQroANUgIu+/L5rmDNm2sNRosSFhiwIxAJCUcbHNdC9x19w4ziSZ
5eviwHfCb/aiN6ceJwNPPdEjZB95rxw4oszRgXhgaho7+Q==
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
MIIEVjCCAj6gAwIBAgIQY5WTY8JOcIJxWRi/w9ftVjANBgkqhkiG9w0BAQsFADBP
MQswCQYDVQQGEwJVUzEpMCcGA1UEChMgSW50ZXJuZXQgU2VjdXJpdHkgUmVzZWFy
Y2ggR3JvdXAxFTATBgNVBAMTDElTUkcgUm9vdCBYMTAeFw0yNDAzMTMwMDAwMDBa
Fw0yNzAzMTIyMzU5NTlaMDIxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBF
bmNyeXB0MQswCQYDVQQDEwJFODB2MBAGByqGSM49AgEGBSuBBAAiA2IABNFl8l7c
S7QMApzSsvru6WyrOq44ofTUOTIzxULUzDMMNMchIJBwXOhiLxxxs0LXeb5GDcHb
R6EToMffgSZjO9SNHfY9gjMy9vQr5/WWOrQTZxh7az6NSNnq3u2ubT6HTKOB+DCB
9TAOBgNVHQ8BAf8EBAMCAYYwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMB
MBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFI8NE6L2Ln7RUGwzGDhdWY4j
cpHKMB8GA1UdIwQYMBaAFHm0WeZ7tuXkAXOACIjIGlj26ZtuMDIGCCsGAQUFBwEB
BCYwJDAiBggrBgEFBQcwAoYWaHR0cDovL3gxLmkubGVuY3Iub3JnLzATBgNVHSAE
DDAKMAgGBmeBDAECATAnBgNVHR8EIDAeMBygGqAYhhZodHRwOi8veDEuYy5sZW5j
ci5vcmcvMA0GCSqGSIb3DQEBCwUAA4ICAQBnE0hGINKsCYWi0Xx1ygxD5qihEjZ0
RI3tTZz1wuATH3ZwYPIp97kWEayanD1j0cDhIYzy4CkDo2jB8D5t0a6zZWzlr98d
AQFNh8uKJkIHdLShy+nUyeZxc5bNeMp1Lu0gSzE4McqfmNMvIpeiwWSYO9w82Ob8
otvXcO2JUYi3svHIWRm3+707DUbL51XMcY2iZdlCq4Wa9nbuk3WTU4gr6LY8MzVA
aDQG2+4U3eJ6qUF10bBnR1uuVyDYs9RhrwucRVnfuDj29CMLTsplM5f5wSV5hUpm
Uwp/vV7M4w4aGunt74koX71n4EdagCsL/Yk5+mAQU0+tue0JOfAV/R6t1k+Xk9s2
HMQFeoxppfzAVC04FdG9M+AC2JWxmFSt6BCuh3CEey3fE52Qrj9YM75rtvIjsm/1
Hl+u//Wqxnu1ZQ4jpa+VpuZiGOlWrqSP9eogdOhCGisnyewWJwRQOqK16wiGyZeR
xs/Bekw65vwSIaVkBruPiTfMOo0Zh4gVa8/qJgMbJbyrwwG97z/PRgmLKCDl8z3d
tA0Z7qq7fta0Gl24uyuB05dqI5J1LvAzKuWdIjT1tP8qCoxSE/xpix8hX2dt3h+/
jujUgFPFZ0EVZ0xSyBNRF3MboGZnYXFUxpNjTWPKpagDHJQmqrAcDmWJnMsFY3jS
u1igv3OefnWjSQ==
-----END CERTIFICATE-----


EOF

# ایجاد یا بازنویسی فایل key.pem
cat > "$CERTS_DIR/key.pem" << 'EOF'
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEIN4l/GGPELSH2zey9lzvmpZkv6BC6oDZYwuWf/OLn+xmoAoGCCqGSM49
AwEHoUQDQgAE74jLFvIOR5slXBUZ7nF3ZszsfYpl0oqqS65ls+xtuGzhDlMM24W+
6fcxIgLhCo6QssjpSLXIZ80Lwf59KZA/DQ==
-----END EC PRIVATE KEY-----

EOF

# ایمن‌سازی دسترسی‌ها
chmod 600 "$CERTS_DIR/key.pem"
chmod 644 "$CERTS_DIR/fullchain.pem"

echo "All done! Certificates are placed in $CERTS_DIR"
